# Simple HAProxy Configuration Example
# Minimal example for quick testing of GAL import functionality

global
    daemon
    maxconn 256

defaults
    mode http
    timeout client 30s
    timeout server 30s
    timeout connect 10s

frontend http_front
    bind *:80
    use_backend api_backend if { path_beg /api }
    use_backend web_backend if { path_beg /web }
    default_backend app_backend

backend api_backend
    balance roundrobin
    option httpchk GET /health
    http-request set-header X-Backend api
    server api1 api1.internal:8080 check weight 2
    server api2 api2.internal:8080 check weight 1

backend web_backend
    balance leastconn
    server web1 web1.internal:8080
    server web2 web2.internal:8080

backend app_backend
    balance source
    cookie APPID insert indirect
    server app1 app1.internal:8080 check cookie app1
    server app2 app2.internal:8080 check cookie app2
